import{R as d}from"./chunk-OIYGIGL5-BqXurzTp.js";const j=n=>{let r;const s=new Set,i=(c,f)=>{const o=typeof c=="function"?c(r):c;if(!Object.is(o,r)){const p=r;r=f??(typeof o!="object"||o===null)?o:Object.assign({},r,o),s.forEach(b=>b(r,p))}},l=()=>r,h={setState:i,getState:l,getInitialState:()=>g,subscribe:c=>(s.add(c),()=>s.delete(c))},g=r=n(i,l,h);return h},x=(n=>n?j(n):j),E=n=>n;function K(n,r=E){const s=d.useSyncExternalStore(n.subscribe,d.useCallback(()=>r(n.getState()),[n,r]),d.useCallback(()=>r(n.getInitialState()),[n,r]));return d.useDebugValue(s),s}const k=n=>{const r=x(n),s=i=>K(r,i);return Object.assign(s,r),s},R=(n=>n?k(n):k),u=()=>typeof window<"u"&&window.puter?window.puter:null,V=R((n,r)=>{const s=t=>{n({error:t,isLoading:!1,auth:{user:null,isAuthenticated:!1,signIn:r().auth.signIn,signOut:r().auth.signOut,refreshUser:r().auth.refreshUser,checkAuthStatus:r().auth.checkAuthStatus,getUser:r().auth.getUser}})},i=async()=>{const t=u();if(!t)return s("Puter.js not available"),!1;n({isLoading:!0,error:null});try{if(await t.auth.isSignedIn()){const a=await t.auth.getUser();return n({auth:{user:a,isAuthenticated:!0,signIn:r().auth.signIn,signOut:r().auth.signOut,refreshUser:r().auth.refreshUser,checkAuthStatus:r().auth.checkAuthStatus,getUser:()=>a},isLoading:!1}),!0}else return n({auth:{user:null,isAuthenticated:!1,signIn:r().auth.signIn,signOut:r().auth.signOut,refreshUser:r().auth.refreshUser,checkAuthStatus:r().auth.checkAuthStatus,getUser:()=>null},isLoading:!1}),!1}catch(e){const a=e instanceof Error?e.message:"Failed to check auth status";return s(a),!1}},l=async()=>{const t=u();if(!t){s("Puter.js not available");return}n({isLoading:!0,error:null});try{await t.auth.signIn(),await i()}catch(e){const a=e instanceof Error?e.message:"Sign in failed";s(a)}},S=async()=>{const t=u();if(!t){s("Puter.js not available");return}n({isLoading:!0,error:null});try{await t.auth.signOut(),n({auth:{user:null,isAuthenticated:!1,signIn:r().auth.signIn,signOut:r().auth.signOut,refreshUser:r().auth.refreshUser,checkAuthStatus:r().auth.checkAuthStatus,getUser:()=>null},isLoading:!1})}catch(e){const a=e instanceof Error?e.message:"Sign out failed";s(a)}},v=async()=>{const t=u();if(!t){s("Puter.js not available");return}n({isLoading:!0,error:null});try{const e=await t.auth.getUser();n({auth:{user:e,isAuthenticated:!0,signIn:r().auth.signIn,signOut:r().auth.signOut,refreshUser:r().auth.refreshUser,checkAuthStatus:r().auth.checkAuthStatus,getUser:()=>e},isLoading:!1})}catch(e){const a=e instanceof Error?e.message:"Failed to refresh user";s(a)}},h=()=>{if(u()){n({puterReady:!0}),i();return}const e=setInterval(()=>{u()&&(clearInterval(e),n({puterReady:!0}),i())},100);setTimeout(()=>{clearInterval(e),u()||s("Puter.js failed to load within 10 seconds")},1e4)},g=async(t,e)=>{const a=u();if(!a){s("Puter.js not available");return}return a.fs.write(t,e)},c=async t=>{const e=u();if(!e){s("Puter.js not available");return}return e.fs.readdir(t)},f=async t=>{const e=u();if(!e){s("Puter.js not available");return}return e.fs.read(t)},o=async t=>{const e=u();if(!e){s("Puter.js not available");return}return e.fs.upload(t)},p=async t=>{const e=u();if(!e){s("Puter.js not available");return}return e.fs.delete(t)},b=async(t,e,a,y)=>{const I=u();if(!I){s("Puter.js not available");return}return I.ai.chat(t,e,a,y)},P=async(t,e)=>{const a=u();if(!a){s("Puter.js not available");return}return a.ai.chat([{role:"user",content:[{type:"file",puter_path:t},{type:"text",text:e}]}],{model:"claude-3-7-sonnet"})},U=async(t,e)=>{const a=u();if(!a){s("Puter.js not available");return}return a.ai.img2txt(t,e)},m=async t=>{const e=u();if(!e){s("Puter.js not available");return}return e.kv.get(t)},w=async(t,e)=>{const a=u();if(!a){s("Puter.js not available");return}return a.kv.set(t,e)},A=async t=>{const e=u();if(!e){s("Puter.js not available");return}return e.kv.delete(t)},O=async(t,e)=>{const a=u();if(!a){s("Puter.js not available");return}return e===void 0&&(e=!1),a.kv.list(t,e)},L=async()=>{const t=u();if(!t){s("Puter.js not available");return}return t.kv.flush()};return{isLoading:!0,error:null,puterReady:!1,auth:{user:null,isAuthenticated:!1,signIn:l,signOut:S,refreshUser:v,checkAuthStatus:i,getUser:()=>r().auth.user},fs:{write:(t,e)=>g(t,e),read:t=>f(t),readDir:t=>c(t),upload:t=>o(t),delete:t=>p(t)},ai:{chat:(t,e,a,y)=>b(t,e,a,y),feedback:(t,e)=>P(t,e),img2txt:(t,e)=>U(t,e)},kv:{get:t=>m(t),set:(t,e)=>w(t,e),delete:t=>A(t),list:(t,e)=>O(t,e),flush:()=>L()},init:h,clearError:()=>n({error:null})}});export{R as c,V as u};
